#region

using System.Threading;
using System.Threading.Tasks;
using Glimmr.Models.Util;
using Glimmr.Services;
using Serilog;

#endregion

namespace Glimmr.Models.ColorTarget.Led;

public class LedDiscovery : ColorDiscovery, IColorDiscovery {
	public LedDiscovery(ColorService colorService) : base(colorService) { }

	public async Task Discover(int timeout, CancellationToken ct) {
		DataUtil.DeleteDevice("2");

		if (!SystemUtil.IsRaspberryPi()) {
			DataUtil.DeleteDevice("0");
			DataUtil.DeleteDevice("1");
			Log.Debug("No, really, this is not a pi, we shouldn't be creating GPIO stuff here.");
			return;
		}

		var ld0 = new LedData { Id = "0", Brightness = 255, GpioNumber = 18, Enable = true };
		var ld1 = new LedData { Id = "1", Brightness = 255, GpioNumber = 19 };

		await ControlService.AddDevice(ld0);
		await ControlService.AddDevice(ld1);
	}
}